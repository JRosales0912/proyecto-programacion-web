{"version":3,"file":"Layer.base.js","sourceRoot":"../src/","sources":["components/Layer/Layer.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport * as ReactDOM from 'react-dom';\r\n\r\nimport { Fabric } from '../../Fabric';\r\nimport { ILayerProps, ILayerStyleProps, ILayerStyles } from './Layer.types';\r\nimport {\r\n  BaseComponent,\r\n  classNamesFunction,\r\n  customizable,\r\n  getDocument,\r\n  createRef,\r\n  setPortalAttribute,\r\n  setVirtualParent\r\n} from '../../Utilities';\r\nimport { registerLayer, getDefaultTarget, unregisterLayer } from './Layer.notification';\r\n\r\nconst getClassNames = classNamesFunction<ILayerStyleProps, ILayerStyles>();\r\n\r\n@customizable('Layer', ['theme', 'hostId'])\r\nexport class LayerBase extends BaseComponent<ILayerProps, {}> {\r\n  public static defaultProps: ILayerProps = {\r\n    onLayerDidMount: () => undefined,\r\n    onLayerWillUnmount: () => undefined\r\n  };\r\n\r\n  private _host: Node;\r\n  private _layerElement: HTMLElement | undefined;\r\n  private _rootElement = createRef<HTMLDivElement>();\r\n\r\n  constructor(props: ILayerProps) {\r\n    super(props);\r\n\r\n    this._warnDeprecations({\r\n      onLayerMounted: 'onLayerDidMount'\r\n    });\r\n\r\n    if (this.props.hostId) {\r\n      registerLayer(this.props.hostId, this);\r\n    }\r\n  }\r\n\r\n  public componentWillMount(): void {\r\n    this._layerElement = this._getLayerElement();\r\n  }\r\n\r\n  public componentWillUpdate(): void {\r\n    if (!this._layerElement) {\r\n      this._layerElement = this._getLayerElement();\r\n    }\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    this._setVirtualParent();\r\n\r\n    const { onLayerDidMount, onLayerMounted } = this.props;\r\n    if (onLayerMounted) {\r\n      onLayerMounted();\r\n    }\r\n\r\n    if (onLayerDidMount) {\r\n      onLayerDidMount();\r\n    }\r\n  }\r\n\r\n  public componentWillUnmount(): void {\r\n    this._removeLayerElement();\r\n\r\n    const { onLayerWillUnmount, hostId } = this.props;\r\n    if (onLayerWillUnmount) {\r\n      onLayerWillUnmount();\r\n    }\r\n\r\n    if (hostId) {\r\n      unregisterLayer(hostId, this);\r\n    }\r\n  }\r\n\r\n  public componentDidUpdate(): void {\r\n    this._setVirtualParent();\r\n  }\r\n\r\n  public render(): React.ReactNode {\r\n    const classNames = this._getClassNames();\r\n    const { eventBubblingEnabled } = this.props;\r\n\r\n    return (\r\n      <span className=\"ms-layer\" ref={this._rootElement}>\r\n        {this._layerElement &&\r\n          ReactDOM.createPortal(\r\n            eventBubblingEnabled ? (\r\n              <Fabric className={classNames.content}>{this.props.children}</Fabric>\r\n            ) : (\r\n              <Fabric\r\n                className={classNames.content}\r\n                onClick={this._filterEvent}\r\n                onContextMenu={this._filterEvent}\r\n                onDoubleClick={this._filterEvent}\r\n                onDrag={this._filterEvent}\r\n                onDragEnd={this._filterEvent}\r\n                onDragEnter={this._filterEvent}\r\n                onDragExit={this._filterEvent}\r\n                onDragLeave={this._filterEvent}\r\n                onDragOver={this._filterEvent}\r\n                onDragStart={this._filterEvent}\r\n                onDrop={this._filterEvent}\r\n                onMouseDown={this._filterEvent}\r\n                onMouseEnter={this._filterEvent}\r\n                onMouseLeave={this._filterEvent}\r\n                onMouseMove={this._filterEvent}\r\n                onMouseOver={this._filterEvent}\r\n                onMouseOut={this._filterEvent}\r\n                onMouseUp={this._filterEvent}\r\n                onKeyDown={this._filterEvent}\r\n                onKeyPress={this._filterEvent}\r\n                onKeyUp={this._filterEvent}\r\n                onFocus={this._filterEvent}\r\n                onBlur={this._filterEvent}\r\n                onChange={this._filterEvent}\r\n                onInput={this._filterEvent}\r\n                onInvalid={this._filterEvent}\r\n                onSubmit={this._filterEvent}\r\n              >\r\n                {this.props.children}\r\n              </Fabric>\r\n            ),\r\n            this._layerElement\r\n          )}\r\n      </span>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Helper to stop events from bubbling up out of Layer.\r\n   */\r\n  private _filterEvent = (ev: React.SyntheticEvent<HTMLElement>): void => {\r\n    // We should just be able to check ev.bubble here and only stop events that are bubbling up. However, even though mouseenter and\r\n    //    mouseleave do NOT bubble up, they are showing up as bubbling. Therefore we stop events based on event name rather than ev.bubble.\r\n    if (ev.type !== 'mouseenter' && ev.type !== 'mouseleave') {\r\n      ev.stopPropagation();\r\n    }\r\n  };\r\n\r\n  private _getClassNames() {\r\n    const { className, styles, theme } = this.props;\r\n    const classNames = getClassNames(styles!, {\r\n      theme: theme!,\r\n      className,\r\n      isNotHost: !this.props.hostId\r\n    });\r\n\r\n    return classNames;\r\n  }\r\n\r\n  private _setVirtualParent() {\r\n    if (this._rootElement && this._rootElement.current && this._layerElement) {\r\n      setVirtualParent(this._layerElement, this._rootElement.current);\r\n    }\r\n  }\r\n\r\n  private _getLayerElement(): HTMLElement | undefined {\r\n    const host = this._getHost();\r\n\r\n    const classNames = this._getClassNames();\r\n\r\n    if (host !== this._host) {\r\n      this._removeLayerElement();\r\n    }\r\n\r\n    if (host) {\r\n      this._host = host;\r\n\r\n      if (!this._layerElement) {\r\n        const doc = getDocument();\r\n        if (!doc) {\r\n          return;\r\n        }\r\n\r\n        this._layerElement = doc.createElement('div');\r\n        this._layerElement.className = classNames.root!;\r\n        setPortalAttribute(this._layerElement);\r\n\r\n        host.appendChild(this._layerElement);\r\n      }\r\n    }\r\n\r\n    return this._layerElement;\r\n  }\r\n\r\n  private _removeLayerElement(): void {\r\n    if (this._layerElement) {\r\n      this.props.onLayerWillUnmount!();\r\n\r\n      const parentNode = this._layerElement.parentNode;\r\n      if (parentNode) {\r\n        parentNode.removeChild(this._layerElement);\r\n      }\r\n      this._layerElement = undefined;\r\n    }\r\n  }\r\n\r\n  private _getHost(): Node | undefined {\r\n    const { hostId } = this.props;\r\n\r\n    const doc = getDocument();\r\n    if (!doc) {\r\n      return undefined;\r\n    }\r\n\r\n    if (hostId) {\r\n      return doc.getElementById(hostId) as Node;\r\n    } else {\r\n      const defaultHostSelector = getDefaultTarget();\r\n      return defaultHostSelector ? (doc.querySelector(defaultHostSelector) as Node) : doc.body;\r\n    }\r\n  }\r\n}\r\n"]}